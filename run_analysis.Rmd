# Getting and cleaning data course project

### TODO:
* Replace activityId with textual factor
* convert subjectId to a factor
* review column names
* create codebook

```{r "Initialization"}
library(knitr)
opts_chunk$set(cache=TRUE)
rm(list=ls())
```


```{r}
source("UCIDataReader.R")
library(data.table)

```

### Download and read data
```{r "Read Data"}
dataReader <- UCIDataReader()

activityLabel <- dataReader$activityLabel 
feature <- dataReader$feature
train <- dataReader$train
trainSubject <- dataReader$trainSubject
trainActivity <- dataReader$trainActivity
test <- dataReader$test
testSubject <- dataReader$testSubject
testActivity <- dataReader$testActivity

```

### cleanup feature column names
```{r}
# clean up feature names
setnames(feature, c("Id", "Name"))
feature$Name <- gsub("^(t)","Time", feature$Name)
feature$Name <- gsub("^(f)","FreqDomain", feature$Name)
feature$Name <- gsub("BodyBody","Body", feature$Name)
feature$Name <- gsub("BodyAcc","BodyAcceleration", feature$Name)
feature$Name <- gsub("GravityAcc","GravityAcceleration", feature$Name)
feature$Name <- gsub("Mag","Magnitude", feature$Name)
feature$Name <- gsub("Gyro","Gyroscopic", feature$Name)
feature$Name <- gsub("-mean\\(\\)","-Mean", feature$Name)
feature$Name <- gsub("-std\\(\\)","-StdDev", feature$Name)
# angle() fields are not included

```

### Merging training and test dataset
```{r "Merging training and test dataset"}
# add features to both training and test data sets
setnames(train, feature$Name)
setnames(test, feature$Name)

# add activity to both training and test data sets (human readable)
setnames(trainActivity, "ActivityId")
setnames(testActivity, "ActivityId")
train <- cbind(trainActivity, train)
test <- cbind(testActivity, test)

# add subject to both training and test data sets (human readable)
setnames(trainSubject, "SubjectId")
setnames(testSubject, "SubjectId")
train <- cbind(trainSubject, train)
test <- cbind(testSubject, test)

# merge both training and testing data set
combined.df <- rbind(train, test)

```

### Subset dataset
```{r "subset dataset"}
# subset to only mean and sd columns
meanAndStdDevCols <- which(grepl("(-Mean|-StdDev)", colnames(combined.df)))
meanAndStdDevCols <- c(1:2,meanAndStdDevCols)
combinedSubset <- data.table(combined.df[,meanAndStdDevCols])
```

### calculate the mean for all variables for each subject - activity

```{r "summarize at the subjet - activity level"}
tidyData <- combinedSubset[,lapply(.SD,mean),by=list(SubjectId,ActivityId)]
str(tidyData)
head(tidyData)
write.table(tidyData, "tidyData.txt", row.names=FALSE)
```
